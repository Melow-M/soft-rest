<div class="w3-section w3-margin-left w3-margin-right animated fadeInUp delay-2">
    <div class="w3-row">
        <div class="w3-col s0 m1 l1">
            <p></p>
        </div>
        <div class="w3-col s12 m10 l10" style="min-height:86vh; font-family: Raleway;">
            <h1 style="font-size:1.8em; color: #2B2B2B; font-family: Raleway; font-weight: bolder;">
                <mat-icon style="vertical-align: middle; margin-right:0.2em;margin-left:1.5em">%
                </mat-icon> Promociones
            </h1>
            <mat-divider></mat-divider>

            <!-- Search Form -->

                <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: baseline; flex-wrap: wrap ;">  

                    <mat-form-field appearance="outline">
                        <mat-label>Filtrar por nombre</mat-label>
                        <input [formControl]="filterControl" (keyup)="filter()"
                            type="text" placeholder="Filtrar por nombre" matInput>
                        <span matPrefix><mat-icon>filter_list</mat-icon></span>
                    </mat-form-field>

                    <div>
                        <button mat-raised-button color="secondary" type="button" (click)="onCreateNewPromo()">
                            <mat-icon>add_circle</mat-icon>
                            Crear Nuevo
                        </button>
                    </div>

                    <div>
                        <button mat-raised-button color="secondary" type="button">
                            <mat-icon>cloud_download</mat-icon>
                            Descargar
                        </button>
                    </div>

                </div>
                

            <!-- Table -->
            <div>
                <!-- Table -->
                <div class="w3-padding" *ngIf="promoData$ | async">
                          
                    <div style="height: auto; width: 100%; overflow: auto; border-radius: 20px 20px 0 0" class="mat-elevation-z8">
                        <table mat-table [dataSource]="promosTableDataSource" 
                            style="width: 100%; text-align: center !important; width: 100%;">

                            <!-- index -->
                            <ng-container matColumnDef="index">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px;"
                                    class="w3-center w3-padding w3-border-right">
                                    N°</th>
                                <td mat-cell *matCellDef="let element; let i=index">{{i+1}}</td>
                            </ng-container>

                            <!-- createdAt -->
                            <ng-container matColumnDef="createdAt">
                                <th mat-header-cell *matHeaderCellDef
                                    class="w3-center w3-padding w3-border-right" style="text-align: center; padding-right: 8px; padding-left: 8px">
                                    Fecha de Creación</th>
                                <td mat-cell *matCellDef="let element">{{formatDate(element.createdAt) | date:'dd/MM/yyyy'}}</td>
                            </ng-container>

                            <!-- name -->
                            <ng-container matColumnDef="name" sticky>
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Nombre</th>
                                <td mat-cell *matCellDef="let element">{{element.name}}</td>
                            </ng-container>

                            <!-- recipesRecipe -->
                            <ng-container matColumnDef="recipesRecipe">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Productos </th>
                                <td mat-cell *matCellDef="let element" style="text-align: left">
                                    <ul>
                                        <li *ngFor="let recipe of element.recipes">
                                            {{recipe.recipe.name |titlecase}}
                                        </li>
                                    </ul>
                                </td>
                            </ng-container>

                            <!-- state -->
                            <ng-container matColumnDef="state">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Estado</th>
                                <td mat-cell *matCellDef="let element">{{element.state}}</td>
                            </ng-container>

                            <!-- dateRange -->
                            <ng-container matColumnDef="dateRange">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Rango de Fechas</th>
                                <td mat-cell *matCellDef="let element">
                                    {{element.validityPeriod == 'Definido' ? (formatDate(element.dateRange.begin)| date:'dd/MM/yyyy'): null }}
                                    {{element.validityPeriod == 'Definido' ? '-': 'Indefinido'}}
                                    {{element.validityPeriod == 'Definido' ? (formatDate(element.dateRange.end)| date:'dd/MM/yyyy'): null}}</td>
                            </ng-container>

                            <!-- realPrice -->
                            <ng-container matColumnDef="realPrice">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Precio de Venta</th>
                                <td mat-cell *matCellDef="let element">S/.{{element.realPrice.toFixed(2)}}</td>
                            </ng-container>

                            <!-- promoPrice -->
                            <ng-container matColumnDef="promoPrice">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Precio Promocional </th>
                                <td mat-cell *matCellDef="let element">S/.{{element.promoPrice.toFixed(2)}}</td>
                            </ng-container>

                            <!-- disccount -->
                            <ng-container matColumnDef="disccount">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    % DCTO</th>
                                <td mat-cell *matCellDef="let element">
                                    {{((element.realPrice-element.promoPrice)/element.realPrice*100.0).toFixed()}}%</td>
                            </ng-container>

                            <!-- units -->
                            <ng-container matColumnDef="units">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Unidades Disponibles</th>
                                <td mat-cell *matCellDef="let element">
                                    {{element.quantity == 'Definido' ? element.units: 'ilimitado'}}</td>
                            </ng-container>

                            <!-- soldUnits -->
                            <ng-container matColumnDef="soldUnits">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Unidades Vendidas</th>
                                <td mat-cell *matCellDef="let element">{{element.soldUnits}}</td>
                            </ng-container>

                            <!-- createdBy -->
                            <ng-container matColumnDef="createdBy">
                                <th mat-header-cell *matHeaderCellDef style="text-align: center; padding-right: 8px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Creado por: </th>
                                <td mat-cell *matCellDef="let element">{{element.createdBy.displayName}}</td>
                            </ng-container>

                            <!-- actions -->
                            <ng-container matColumnDef="actions" stickyEnd>
                                <th mat-header-cell *matHeaderCellDef style="width: 100px; padding-left: 8px"
                                    class="w3-center w3-padding w3-border-right">
                                    Acciones</th>
                                <td mat-cell *matCellDef="let element; let i=index">
                                    <button mat-button [matMenuTriggerFor]="menu">
                                        <mat-icon>more_vert</mat-icon>
                                    </button>
                                    <mat-menu #menu="matMenu">
                                        <button mat-menu-item *ngIf="element.state == 'Inactivo'" (click)="changeOfferState(element, 'Activar')">Activar</button>
                                        <button mat-menu-item *ngIf="element.state == 'Publicado'" (click)="changeOfferState(element, 'Inactivar')">Inactivar</button>
                                    </mat-menu>
                                </td>
                            </ng-container>

                
                        <tr mat-header-row *matHeaderRowDef="promosTableDisplayedColumns" style="text-align-last: center;"></tr>
                        <tr mat-row *matRowDef="let row; columns: promosTableDisplayedColumns;"></tr>
                
                
                        </table>
                    </div>

                    <mat-paginator #promoTablePaginator [pageSizeOptions]="[5,10,25]" 
                        fixed class="mat-elevation-z8" style="border-radius: 0 0 20px 20px;">
                    </mat-paginator>
                        

                </div>

            </div>

        </div>
        <div class="w3-col s0 m1 l1">
            <p></p>
        </div>
    </div>
</div>